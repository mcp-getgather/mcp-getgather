name: Astro

signin:
  fields:
    - name: phone
      type: text
      prompt: phone number
      selector: input[name=phone]
    - name: wait_after_phone
      type: wait
      selector: '[data-testid="btnSubmitPhoneNumber"]:not([disabled])'
    - name: continue
      type: click
      prompt: Continue
      selector: '[data-testid="btnSubmitPhoneNumber"]'
    - name: otp
      type: text
      prompt: One-time code
      selector: '[data-testid="otpInput0"]'

  pages:
    - name: Log in
      url: https://www.astronauts.id/login
      fields: [phone, wait_after_phone, continue]
    - name: OTP page
      fields: [otp]
    - name: Home page
      url: https://www.astronauts.id
      end: true
  start: Log in

extract:
  steps:
    - name: Go to order history
      url: https://www.astronauts.id/order/history

    - name: Wait for orders to load
      wait_for_selector: div.MuiGrid-item.css-1928xuh

    - name: Extract past orders
      bundle: orders.html
      slurp_selector: div.MuiGrid-container

parse:
  - bundle: orders.html
    format: html
    output: orders.json
    row_selector: div.MuiGrid-item.css-1928xuh
    columns:
      - name: order_status
        selector: h3.MuiTypography-headline-tiny
      - name: order_date
        selector: div.css-0 span.MuiTypography-paragraph-tiny:first-child
      - name: product_count
        selector: div.css-0 span.MuiTypography-paragraph-tiny:last-child
      - name: product_image
        selector: div.css-lld82g img
        attribute: src
      - name: product_id
        selector: div.css-lld82g img
        attribute: alt

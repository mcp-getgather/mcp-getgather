name: CNN

signin:
  fields:
    - name: email
      type: text
      prompt: Email address
      selector: input[type=email]
    - name: password
      type: password
      prompt: Password
      selector: input[type=password]
    - name: agree_to_terms
      type: autoclick
      prompt: Agree to terms
      selector: a:has-text("Agree")
    - name: submit
      type: click
      prompt: Submit
      selector: button[type=submit]
      expect_nav: true
      url: https://audience.cnn.com/core/api/2/user/login
    - name: home_page
      type: wait
      selector: button#headerSearchIcon
    - name: message_error
      type: message
      selector: form.user-account-login-form__form p.feedback-message__text
      label: form.user-account-login-form__form p.feedback-message__text
      prompt: ‚ùå The username/password you entered is incorrect. Please try again.
    - name: newsletter-section
      type: wait
      selector: section li[data-newsletter-id]:nth-child(1)
  pages:
    - name: Terms page
      fields: [agree_to_terms]
    - name: Email form
      fields:
        required: [agree_to_terms, email, password, submit]
        optional: [message_error]
    - name: Home address
      fields: [home_page]
      end: true

  start: https://edition.cnn.com/account/log-in

extract:
  steps:
    - name: Go to the newsletter list
      url: https://www.cnn.com/newsletters

    - name: Wait for the loading
      timeout: 5
      wait_for_selector: section li[data-newsletter-id]:nth-child(1)

    - name: Extract the list of subscribed newsletters
      bundle: subscriptions.html
      slurp_selector: li[data-subscription-status=subscribed]
